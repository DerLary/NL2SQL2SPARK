{
    "query_id": 1241,
    "difficulty": "challenging",
    "is_initial": true,
    "nl_query": "For patients with abnormal platelet level, state the number of patients with lower than normal range. How is it compare to the number of patients with higher than normal range? abnormal platelet level refers to PLT <= 100 or PLT >= 400; platelet level lower than normal range refers to PLT < 100; calculation = SUBTRACT(SUM(PLT < 100), SUM(PLT > 400)); platelet level higher than normal range refers to PLT > 400;",
    "golden_query": "SELECT SUM(CASE WHEN T2.PLT <= 100 THEN 1 ELSE 0 END) - SUM(CASE WHEN T2.PLT >= 400 THEN 1 ELSE 0 END) FROM Patient AS T1 INNER JOIN Laboratory AS T2 ON T1.ID = T2.ID",
    "sparksql_query": "SELECT SUM(CASE WHEN PLT < 100 THEN 1 ELSE 0 END) AS lower_than_normal, SUM(CASE WHEN PLT > 400 THEN 1 ELSE 0 END) AS higher_than_normal, SUM(CASE WHEN PLT < 100 THEN 1 ELSE 0 END) - SUM(CASE WHEN PLT > 400 THEN 1 ELSE 0 END) AS difference FROM laboratory WHERE PLT < 100 OR PLT > 400",
    "jaccard_index": 0.0,
    "exact_match": 0,
    "ground_truth": [
        {
            "(sum(CASE WHEN (PLT <= 100) THEN 1 ELSE 0 END) - sum(CASE WHEN (PLT >= 400) THEN 1 ELSE 0 END))": -562
        }
    ],
    "query_result": [
        [
            "320",
            "875",
            "-555"
        ]
    ],
    "execution_plans": {
        "golden_query": "\nExecution Plan for: Golden Query ID 1241...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'Project [unresolvedalias(('SUM(CASE WHEN ('T2.PLT <= 100) THEN 1 ELSE 0 END) - 'SUM(CASE WHEN ('T2.PLT >= 400) THEN 1 ELSE 0 END)))]\n+- 'Join Inner, ('T1.ID = 'T2.ID)\n   :- 'SubqueryAlias T1\n   :  +- 'UnresolvedRelation [Patient], [], false\n   +- 'SubqueryAlias T2\n      +- 'UnresolvedRelation [Laboratory], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nAggregate [(sum(CASE WHEN (PLT#26818 <= 100) THEN 1 ELSE 0 END) - sum(CASE WHEN (PLT#26818 >= 400) THEN 1 ELSE 0 END)) AS (sum(CASE WHEN (PLT <= 100) THEN 1 ELSE 0 END) - sum(CASE WHEN (PLT >= 400) THEN 1 ELSE 0 END))#26844L]\n+- Project [PLT#26818]\n   +- Join Inner, (ID#26791 = ID#26798)\n      :- Project [ID#26791]\n      :  +- Filter isnotnull(ID#26791)\n      :     +- Relation [ID#26791,SEX#26792,Birthday#26793,Description#26794,First Date#26795,Admission#26796,Diagnosis#26797] JDBCRelation((SELECT \"ID\", \"SEX\", CAST(\"Birthday\" AS TEXT) AS \"Birthday\", CAST(\"Description\" AS TEXT) AS \"Description\", CAST(\"First Date\" AS TEXT) AS \"First Date\", \"Admission\", \"Diagnosis\" FROM \"Patient\") AS \"Patient\") [numPartitions=1]\n      +- Project [ID#26798, PLT#26818]\n         +- Filter isnotnull(ID#26798)\n            +- Relation [ID#26798,Date#26799,GOT#26800,GPT#26801,LDH#26802,ALP#26803,TP#26804,ALB#26805,UA#26806,UN#26807,CRE#26808,T-BIL#26809,T-CHO#26810,TG#26811,CPK#26812,GLU#26813,WBC#26814,RBC#26815,HGB#26816,HCT#26817,PLT#26818,PT#26819,APTT#26820,FG#26821,PIC#26822,... 19 more fields] JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- HashAggregate(keys=[], functions=[sum(CASE WHEN (PLT#26818 <= 100) THEN 1 ELSE 0 END), sum(CASE WHEN (PLT#26818 >= 400) THEN 1 ELSE 0 END)], output=[(sum(CASE WHEN (PLT <= 100) THEN 1 ELSE 0 END) - sum(CASE WHEN (PLT >= 400) THEN 1 ELSE 0 END))#26844L])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=44817]\n      +- HashAggregate(keys=[], functions=[partial_sum(CASE WHEN (PLT#26818 <= 100) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (PLT#26818 >= 400) THEN 1 ELSE 0 END)], output=[sum#26847L, sum#26848L])\n        +- Project [PLT#26818]\n            +- SortMergeJoin [ID#26791], [ID#26798], Inner\n              :- Sort [ID#26791 ASC NULLS FIRST], false, 0\n              :  +- Exchange hashpartitioning(ID#26791, 200), ENSURE_REQUIREMENTS, [plan_id=44809]\n              :     +- Scan JDBCRelation((SELECT \"ID\", \"SEX\", CAST(\"Birthday\" AS TEXT) AS \"Birthday\", CAST(\"Description\" AS TEXT) AS \"Description\", CAST(\"First Date\" AS TEXT) AS \"First Date\", \"Admission\", \"Diagnosis\" FROM \"Patient\") AS \"Patient\") [numPartitions=1] [ID#26791] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int>\n              +- Sort [ID#26798 ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(ID#26798, 200), ENSURE_REQUIREMENTS, [plan_id=44810]\n                    +- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [ID#26798,PLT#26818] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int,PLT:int>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- HashAggregate(keys=[], functions=[sum(CASE WHEN (PLT#26818 <= 100) THEN 1 ELSE 0 END), sum(CASE WHEN (PLT#26818 >= 400) THEN 1 ELSE 0 END)])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=44854]\n  +- HashAggregate(keys=[], functions=[partial_sum(CASE WHEN (PLT#26818 <= 100) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (PLT#26818 >= 400) THEN 1 ELSE 0 END)])\n  +- Project [PLT#26818]\n  +- SortMergeJoin [ID#26791], [ID#26798], Inner\n  :- Sort [ID#26791 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(ID#26791, 200), ENSURE_REQUIREMENTS, [plan_id=44846]\n  :     +- Scan JDBCRelation((SELECT \"ID\", \"SEX\", CAST(\"Birthday\" AS TEXT) AS \"Birthday\", CAST(\"Description\" AS TEXT) AS \"Description\", CAST(\"First Date\" AS TEXT) AS \"First Date\", \"Admission\", \"Diagnosis\" FROM \"Patient\") AS \"Patient\") [numPartitions=1] [ID#26791] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int>\n  +- Sort [ID#26798 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(ID#26798, 200), ENSURE_REQUIREMENTS, [plan_id=44847]\n  +- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [ID#26798,PLT#26818] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int,PLT:int>\n================================================================================",
        "model_query": "\nExecution Plan for: Model Query ID 1241...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'Project ['SUM(CASE WHEN ('PLT < 100) THEN 1 ELSE 0 END) AS lower_than_normal#26860, 'SUM(CASE WHEN ('PLT > 400) THEN 1 ELSE 0 END) AS higher_than_normal#26861, ('SUM(CASE WHEN ('PLT < 100) THEN 1 ELSE 0 END) - 'SUM(CASE WHEN ('PLT > 400) THEN 1 ELSE 0 END)) AS difference#26862]\n+- 'Filter (('PLT < 100) OR ('PLT > 400))\n   +- 'UnresolvedRelation [laboratory], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nAggregate [sum(CASE WHEN (PLT#26818 < 100) THEN 1 ELSE 0 END) AS lower_than_normal#26860L, sum(CASE WHEN (PLT#26818 > 400) THEN 1 ELSE 0 END) AS higher_than_normal#26861L, (sum(CASE WHEN (PLT#26818 < 100) THEN 1 ELSE 0 END) - sum(CASE WHEN (PLT#26818 > 400) THEN 1 ELSE 0 END)) AS difference#26862L]\n+- Project [PLT#26818]\n   +- Filter ((PLT#26818 < 100) OR (PLT#26818 > 400))\n      +- Relation [ID#26798,Date#26799,GOT#26800,GPT#26801,LDH#26802,ALP#26803,TP#26804,ALB#26805,UA#26806,UN#26807,CRE#26808,T-BIL#26809,T-CHO#26810,TG#26811,CPK#26812,GLU#26813,WBC#26814,RBC#26815,HGB#26816,HCT#26817,PLT#26818,PT#26819,APTT#26820,FG#26821,PIC#26822,... 19 more fields] JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- HashAggregate(keys=[], functions=[sum(CASE WHEN (PLT#26818 < 100) THEN 1 ELSE 0 END), sum(CASE WHEN (PLT#26818 > 400) THEN 1 ELSE 0 END)], output=[lower_than_normal#26860L, higher_than_normal#26861L, difference#26862L])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=44870]\n      +- HashAggregate(keys=[], functions=[partial_sum(CASE WHEN (PLT#26818 < 100) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (PLT#26818 > 400) THEN 1 ELSE 0 END)], output=[sum#26869L, sum#26870L])\n        +- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [PLT#26818] PushedFilters: [*Or(LessThan(PLT,100),GreaterThan(PLT,400))], ReadSchema: struct<PLT:int>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- HashAggregate(keys=[], functions=[sum(CASE WHEN (PLT#26818 < 100) THEN 1 ELSE 0 END), sum(CASE WHEN (PLT#26818 > 400) THEN 1 ELSE 0 END)])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=44886]\n  +- HashAggregate(keys=[], functions=[partial_sum(CASE WHEN (PLT#26818 < 100) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (PLT#26818 > 400) THEN 1 ELSE 0 END)])\n  +- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [PLT#26818] PushedFilters: [*Or(LessThan(PLT,100),GreaterThan(PLT,400))], ReadSchema: struct<PLT:int>\n================================================================================"
    },
    "result_file_path": "/home/lars/Privat/RWTH/Auslandssemester/#KURSE/Safe Distributed Systems/Exercises/Practical_Exercise/NL2SQL2SPARK/RAW_RESULTS/benchmark_results_20260102_google_65adecc8/1241/20260102_171700_ID_1241_ITER_4_cb46edd7.json",
    "explainer_metrics": {
        "golden_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 2,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 1,
                "ShuffleExchange": 0,
                "TOTAL": 3
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"ID\", \"SEX\", CAST(\"Birthday\" AS TEXT) AS \"Birthday\", CAST(\"Description\" AS TEXT) AS \"Description\", CAST(\"First Date\" AS TEXT) AS \"First Date\", \"Admission\", \"Diagnosis\" FROM \"Patient\") AS \"Patient\") [numPartitions=1] [ID#26791] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int>",
                    "filters": [
                        "*IsNotNull(ID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [ID#26798,PLT#26818] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int,PLT:int>",
                    "filters": [
                        "*IsNotNull(ID)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"ID\", \"SEX\", CAST(\"Birthday\" AS TEXT) AS \"Birthday\", CAST(\"Description\" AS TEXT) AS \"Description\", CAST(\"First Date\" AS TEXT) AS \"First Date\", \"Admission\", \"Diagnosis\" FROM \"Patient\") AS \"Patient\") [numPartitions=1] [ID#26791] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int>",
                    "filters": [
                        "*IsNotNull(ID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [ID#26798,PLT#26818] PushedFilters: [*IsNotNull(ID)], ReadSchema: struct<ID:int,PLT:int>",
                    "filters": [
                        "*IsNotNull(ID)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 2
        },
        "model_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 0,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 1,
                "ShuffleExchange": 0,
                "TOTAL": 1
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [PLT#26818] PushedFilters: [*Or(LessThan(PLT,100),GreaterThan(PLT,400))], ReadSchema: struct<PLT:int>",
                    "filters": [
                        "*Or(LessThan(PLT",
                        "100)",
                        "GreaterThan(PLT",
                        "400))"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"ID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"GOT\", \"GPT\", \"LDH\", \"ALP\", \"TP\", \"ALB\", \"UA\", \"UN\", \"CRE\", \"T-BIL\", \"T-CHO\", \"TG\", \"CPK\", \"GLU\", \"WBC\", \"RBC\", \"HGB\", \"HCT\", \"PLT\", \"PT\", \"APTT\", \"FG\", \"PIC\", \"TAT\", \"TAT2\", \"U-PRO\", \"IGG\", \"IGA\", \"IGM\", \"CRP\", \"RA\", \"RF\", \"C3\", \"C4\", \"RNP\", \"SM\", \"SC170\", \"SSA\", \"SSB\", \"CENTROMEA\", \"DNA\", \"DNA-II\" FROM \"Laboratory\") AS \"Laboratory\") [numPartitions=1] [PLT#26818] PushedFilters: [*Or(LessThan(PLT,100),GreaterThan(PLT,400))], ReadSchema: struct<PLT:int>",
                    "filters": [
                        "*Or(LessThan(PLT",
                        "100)",
                        "GreaterThan(PLT",
                        "400))"
                    ]
                }
            ],
            "filter_count_before_optimization": 1,
            "filter_count_after_optimization": 1
        },
        "plan_equivalence": {
            "golden_vs_model_physical_equivalent": false
        }
    }
}