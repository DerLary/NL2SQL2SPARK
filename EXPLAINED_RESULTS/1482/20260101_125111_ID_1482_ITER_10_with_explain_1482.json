{
    "query_id": 1482,
    "difficulty": "challenging",
    "is_initial": true,
    "nl_query": "Which of the three segments\u2014SME, LAM and KAM\u2014has the biggest and lowest percentage increases in consumption paid in EUR between 2012 and 2013? Increase or Decrease = consumption for 2013 - consumption for 2012; Percentage of Increase = (Increase or Decrease / consumption for 2013) * 100%; The first 4 strings of the Date values in the yearmonth table can represent year",
    "golden_query": "SELECT CAST((SUM(IF(T1.Segment = 'SME' AND T2.Date LIKE '2013%', T2.Consumption, 0)) - SUM(IF(T1.Segment = 'SME' AND T2.Date LIKE '2012%', T2.Consumption, 0))) AS FLOAT) * 100 / SUM(IF(T1.Segment = 'SME' AND T2.Date LIKE '2012%', T2.Consumption, 0)), CAST(SUM(IF(T1.Segment = 'LAM' AND T2.Date LIKE '2013%', T2.Consumption, 0)) - SUM(IF(T1.Segment = 'LAM' AND T2.Date LIKE '2012%', T2.Consumption, 0)) AS FLOAT) * 100 / SUM(IF(T1.Segment = 'LAM' AND T2.Date LIKE '2012%', T2.Consumption, 0)), CAST(SUM(IF(T1.Segment = 'KAM' AND T2.Date LIKE '2013%', T2.Consumption, 0)) - SUM(IF(T1.Segment = 'KAM' AND T2.Date LIKE '2012%', T2.Consumption, 0)) AS FLOAT) * 100 / SUM(IF(T1.Segment = 'KAM' AND T2.Date LIKE '2012%', T2.Consumption, 0)) FROM customers AS T1 INNER JOIN yearmonth AS T2 ON T1.CustomerID = T2.CustomerID",
    "sparksql_query": "WITH YearlyConsumption AS (SELECT c.Segment, SUBSTR(t.Date, 1, 4) AS Year, SUM(t.Price) AS TotalConsumption FROM customers c JOIN transactions_1k t ON c.CustomerID = t.CustomerID WHERE c.Currency = 'EUR' AND SUBSTR(t.Date, 1, 4) IN ('2012', '2013') GROUP BY c.Segment, SUBSTR(t.Date, 1, 4)) SELECT yc2013.Segment, yc2013.TotalConsumption AS Consumption2013, yc2012.TotalConsumption AS Consumption2012, (yc2013.TotalConsumption - yc2012.TotalConsumption) AS IncreaseDecrease, (CAST((yc2013.TotalConsumption - yc2012.TotalConsumption) AS DOUBLE) / yc2013.TotalConsumption) * 100 AS PercentageIncrease FROM YearlyConsumption yc2013 JOIN YearlyConsumption yc2012 ON yc2013.Segment = yc2012.Segment WHERE yc2013.Year = '2013' AND yc2012.Year = '2012' ORDER BY PercentageIncrease DESC;",
    "jaccard_index": null,
    "exact_match": null,
    "ground_truth": null,
    "query_result": null,
    "execution_plans": {
        "golden_query": "\nExecution Plan for: Golden Query ID 1482...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'Project [unresolvedalias(((cast(('SUM('IF((('T1.Segment = SME) AND 'T2.Date LIKE 2013%), 'T2.Consumption, 0)) - 'SUM('IF((('T1.Segment = SME) AND 'T2.Date LIKE 2012%), 'T2.Consumption, 0))) as float) * 100) / 'SUM('IF((('T1.Segment = SME) AND 'T2.Date LIKE 2012%), 'T2.Consumption, 0)))), unresolvedalias(((cast(('SUM('IF((('T1.Segment = LAM) AND 'T2.Date LIKE 2013%), 'T2.Consumption, 0)) - 'SUM('IF((('T1.Segment = LAM) AND 'T2.Date LIKE 2012%), 'T2.Consumption, 0))) as float) * 100) / 'SUM('IF((('T1.Segment = LAM) AND 'T2.Date LIKE 2012%), 'T2.Consumption, 0)))), unresolvedalias(((cast(('SUM('IF((('T1.Segment = KAM) AND 'T2.Date LIKE 2013%), 'T2.Consumption, 0)) - 'SUM('IF((('T1.Segment = KAM) AND 'T2.Date LIKE 2012%), 'T2.Consumption, 0))) as float) * 100) / 'SUM('IF((('T1.Segment = KAM) AND 'T2.Date LIKE 2012%), 'T2.Consumption, 0))))]\n+- 'Join Inner, ('T1.CustomerID = 'T2.CustomerID)\n   :- 'SubqueryAlias T1\n   :  +- 'UnresolvedRelation [customers], [], false\n   +- 'SubqueryAlias T2\n      +- 'UnresolvedRelation [yearmonth], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nAggregate [((cast(cast((sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0) - sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)) as float) as double) * 100.0) / sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)) AS ((CAST((sum((IF(((Segment = SME) AND Date LIKE 2013%), Consumption, 0))) - sum((IF(((Segment = SME) AND Date LIKE 2012%), Consumption, 0)))) AS FLOAT) * 100) / sum((IF(((Segment = SME) AND Date LIKE 2012%), Consumption, 0))))#29234, ((cast(cast((sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0) - sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)) as float) as double) * 100.0) / sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)) AS ((CAST((sum((IF(((Segment = LAM) AND Date LIKE 2013%), Consumption, 0))) - sum((IF(((Segment = LAM) AND Date LIKE 2012%), Consumption, 0)))) AS FLOAT) * 100) / sum((IF(((Segment = LAM) AND Date LIKE 2012%), Consumption, 0))))#29235, ((cast(cast((sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0) - sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)) as float) as double) * 100.0) / sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)) AS ((CAST((sum((IF(((Segment = KAM) AND Date LIKE 2013%), Consumption, 0))) - sum((IF(((Segment = KAM) AND Date LIKE 2012%), Consumption, 0)))) AS FLOAT) * 100) / sum((IF(((Segment = KAM) AND Date LIKE 2012%), Consumption, 0))))#29236]\n+- Project [Segment#29203, Date#29223, Consumption#29224]\n   +- Join Inner, (CustomerID#29202 = CustomerID#29222)\n      :- Project [CustomerID#29202, Segment#29203]\n      :  +- Filter isnotnull(CustomerID#29202)\n      :     +- Relation [CustomerID#29202,Segment#29203,Currency#29204] JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1]\n      +- Filter isnotnull(CustomerID#29222)\n         +- Relation [CustomerID#29222,Date#29223,Consumption#29224] JDBCRelation((SELECT \"CustomerID\", \"Date\", \"Consumption\" FROM \"yearmonth\") AS \"yearmonth\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- HashAggregate(keys=[], functions=[sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)], output=[((CAST((sum((IF(((Segment = SME) AND Date LIKE 2013%), Consumption, 0))) - sum((IF(((Segment = SME) AND Date LIKE 2012%), Consumption, 0)))) AS FLOAT) * 100) / sum((IF(((Segment = SME) AND Date LIKE 2012%), Consumption, 0))))#29234, ((CAST((sum((IF(((Segment = LAM) AND Date LIKE 2013%), Consumption, 0))) - sum((IF(((Segment = LAM) AND Date LIKE 2012%), Consumption, 0)))) AS FLOAT) * 100) / sum((IF(((Segment = LAM) AND Date LIKE 2012%), Consumption, 0))))#29235, ((CAST((sum((IF(((Segment = KAM) AND Date LIKE 2013%), Consumption, 0))) - sum((IF(((Segment = KAM) AND Date LIKE 2012%), Consumption, 0)))) AS FLOAT) * 100) / sum((IF(((Segment = KAM) AND Date LIKE 2012%), Consumption, 0))))#29236])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=48122]\n      +- HashAggregate(keys=[], functions=[partial_sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)], output=[sum#29243, sum#29244, sum#29245, sum#29246, sum#29247, sum#29248])\n        +- Project [Segment#29203, Date#29223, Consumption#29224]\n            +- SortMergeJoin [CustomerID#29202], [CustomerID#29222], Inner\n              :- Sort [CustomerID#29202 ASC NULLS FIRST], false, 0\n              :  +- Exchange hashpartitioning(CustomerID#29202, 200), ENSURE_REQUIREMENTS, [plan_id=48114]\n              :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Segment:string>\n              +- Sort [CustomerID#29222 ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(CustomerID#29222, 200), ENSURE_REQUIREMENTS, [plan_id=48115]\n                    +- Scan JDBCRelation((SELECT \"CustomerID\", \"Date\", \"Consumption\" FROM \"yearmonth\") AS \"yearmonth\") [numPartitions=1] [CustomerID#29222,Date#29223,Consumption#29224] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Date:string,Consumption:double>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- HashAggregate(keys=[], functions=[sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=48159]\n  +- HashAggregate(keys=[], functions=[partial_sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = SME) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = LAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2013))) Consumption#29224 else 0.0), partial_sum(if (((Segment#29203 = KAM) AND StartsWith(Date#29223, 2012))) Consumption#29224 else 0.0)])\n  +- Project [Segment#29203, Date#29223, Consumption#29224]\n  +- SortMergeJoin [CustomerID#29202], [CustomerID#29222], Inner\n  :- Sort [CustomerID#29202 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(CustomerID#29202, 200), ENSURE_REQUIREMENTS, [plan_id=48151]\n  :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Segment:string>\n  +- Sort [CustomerID#29222 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(CustomerID#29222, 200), ENSURE_REQUIREMENTS, [plan_id=48152]\n  +- Scan JDBCRelation((SELECT \"CustomerID\", \"Date\", \"Consumption\" FROM \"yearmonth\") AS \"yearmonth\") [numPartitions=1] [CustomerID#29222,Date#29223,Consumption#29224] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Date:string,Consumption:double>\n================================================================================",
        "model_query": "\nExecution Plan for: Model Query ID 1482...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\nCTE [YearlyConsumption]\n:  +- 'SubqueryAlias YearlyConsumption\n:     +- 'Aggregate ['c.Segment, 'SUBSTR('t.Date, 1, 4)], ['c.Segment, 'SUBSTR('t.Date, 1, 4) AS Year#29281, 'SUM('t.Price) AS TotalConsumption#29282]\n:        +- 'Filter (('c.Currency = EUR) AND 'SUBSTR('t.Date, 1, 4) IN (2012,2013))\n:           +- 'Join Inner, ('c.CustomerID = 't.CustomerID)\n:              :- 'SubqueryAlias c\n:              :  +- 'UnresolvedRelation [customers], [], false\n:              +- 'SubqueryAlias t\n:                 +- 'UnresolvedRelation [transactions_1k], [], false\n+- 'Sort ['PercentageIncrease DESC NULLS LAST], true\n   +- 'Project ['yc2013.Segment, 'yc2013.TotalConsumption AS Consumption2013#29277, 'yc2012.TotalConsumption AS Consumption2012#29278, ('yc2013.TotalConsumption - 'yc2012.TotalConsumption) AS IncreaseDecrease#29279, ((cast(('yc2013.TotalConsumption - 'yc2012.TotalConsumption) as double) / 'yc2013.TotalConsumption) * 100) AS PercentageIncrease#29280]\n      +- 'Filter (('yc2013.Year = 2013) AND ('yc2012.Year = 2012))\n         +- 'Join Inner, ('yc2013.Segment = 'yc2012.Segment)\n            :- 'SubqueryAlias yc2013\n            :  +- 'UnresolvedRelation [YearlyConsumption], [], false\n            +- 'SubqueryAlias yc2012\n               +- 'UnresolvedRelation [YearlyConsumption], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nSort [PercentageIncrease#29280 DESC NULLS LAST], true\n+- Project [Segment#29203, TotalConsumption#29282 AS Consumption2013#29277, TotalConsumption#29286 AS Consumption2012#29278, (TotalConsumption#29282 - TotalConsumption#29286) AS IncreaseDecrease#29279, (((TotalConsumption#29282 - TotalConsumption#29286) / TotalConsumption#29282) * 100.0) AS PercentageIncrease#29280]\n   +- Join Inner, (Segment#29203 = Segment#29303)\n      :- Aggregate [Segment#29203, _groupingexpression#29301], [Segment#29203, sum(Price#29219) AS TotalConsumption#29282]\n      :  +- Project [Segment#29203, Price#29219, substr(cast(Date#29212 as string), 1, 4) AS _groupingexpression#29301]\n      :     +- Join Inner, (CustomerID#29202 = CustomerID#29214)\n      :        :- Project [CustomerID#29202, Segment#29203]\n      :        :  +- Filter ((isnotnull(Currency#29204) AND (Currency#29204 = EUR)) AND (isnotnull(CustomerID#29202) AND isnotnull(Segment#29203)))\n      :        :     +- Relation [CustomerID#29202,Segment#29203,Currency#29204] JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1]\n      :        +- Project [Date#29212, CustomerID#29214, Price#29219]\n      :           +- Filter ((isnotnull(Date#29212) AND (substr(cast(Date#29212 as string), 1, 4) IN (2012,2013) AND (substr(cast(Date#29212 as string), 1, 4) = 2013))) AND isnotnull(CustomerID#29214))\n      :              +- Relation [TransactionID#29211,Date#29212,Time#29213,CustomerID#29214,CardID#29215,GasStationID#29216,ProductID#29217,Amount#29218,Price#29219] JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1]\n      +- Aggregate [Segment#29303, _groupingexpression#29314], [Segment#29303, sum(Price#29313) AS TotalConsumption#29286]\n         +- Project [Segment#29303, Price#29313, substr(cast(Date#29306 as string), 1, 4) AS _groupingexpression#29314]\n            +- Join Inner, (CustomerID#29302 = CustomerID#29308)\n               :- Project [CustomerID#29302, Segment#29303]\n               :  +- Filter ((isnotnull(Currency#29304) AND (Currency#29304 = EUR)) AND (isnotnull(CustomerID#29302) AND isnotnull(Segment#29303)))\n               :     +- Relation [CustomerID#29302,Segment#29303,Currency#29304] JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1]\n               +- Project [Date#29306, CustomerID#29308, Price#29313]\n                  +- Filter ((isnotnull(Date#29306) AND (substr(cast(Date#29306 as string), 1, 4) IN (2012,2013) AND (substr(cast(Date#29306 as string), 1, 4) = 2012))) AND isnotnull(CustomerID#29308))\n                     +- Relation [TransactionID#29305,Date#29306,Time#29307,CustomerID#29308,CardID#29309,GasStationID#29310,ProductID#29311,Amount#29312,Price#29313] JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- Sort [PercentageIncrease#29280 DESC NULLS LAST], true, 0\n  +- Exchange rangepartitioning(PercentageIncrease#29280 DESC NULLS LAST, 200), ENSURE_REQUIREMENTS, [plan_id=48272]\n      +- Project [Segment#29203, TotalConsumption#29282 AS Consumption2013#29277, TotalConsumption#29286 AS Consumption2012#29278, (TotalConsumption#29282 - TotalConsumption#29286) AS IncreaseDecrease#29279, (((TotalConsumption#29282 - TotalConsumption#29286) / TotalConsumption#29282) * 100.0) AS PercentageIncrease#29280]\n        +- SortMergeJoin [Segment#29203], [Segment#29303], Inner\n            :- Sort [Segment#29203 ASC NULLS FIRST], false, 0\n            :  +- Exchange hashpartitioning(Segment#29203, 200), ENSURE_REQUIREMENTS, [plan_id=48265]\n            :     +- HashAggregate(keys=[Segment#29203, _groupingexpression#29301], functions=[sum(Price#29219)], output=[Segment#29203, TotalConsumption#29282])\n            :        +- Exchange hashpartitioning(Segment#29203, _groupingexpression#29301, 200), ENSURE_REQUIREMENTS, [plan_id=48250]\n            :           +- HashAggregate(keys=[Segment#29203, _groupingexpression#29301], functions=[partial_sum(Price#29219)], output=[Segment#29203, _groupingexpression#29301, sum#29318])\n            :              +- Project [Segment#29203, Price#29219, substr(cast(Date#29212 as string), 1, 4) AS _groupingexpression#29301]\n            :                 +- SortMergeJoin [CustomerID#29202], [CustomerID#29214], Inner\n            :                    :- Sort [CustomerID#29202 ASC NULLS FIRST], false, 0\n            :                    :  +- Exchange hashpartitioning(CustomerID#29202, 200), ENSURE_REQUIREMENTS, [plan_id=48242]\n            :                    :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>\n            :                    +- Sort [CustomerID#29214 ASC NULLS FIRST], false, 0\n            :                       +- Exchange hashpartitioning(CustomerID#29214, 200), ENSURE_REQUIREMENTS, [plan_id=48243]\n            :                          +- Filter (substr(cast(Date#29212 as string), 1, 4) IN (2012,2013) AND (substr(cast(Date#29212 as string), 1, 4) = 2013))\n            :                             +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29212,CustomerID#29214,Price#29219] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>\n            +- Sort [Segment#29303 ASC NULLS FIRST], false, 0\n              +- Exchange hashpartitioning(Segment#29303, 200), ENSURE_REQUIREMENTS, [plan_id=48266]\n                  +- HashAggregate(keys=[Segment#29303, _groupingexpression#29314], functions=[sum(Price#29313)], output=[Segment#29303, TotalConsumption#29286])\n                    +- Exchange hashpartitioning(Segment#29303, _groupingexpression#29314, 200), ENSURE_REQUIREMENTS, [plan_id=48261]\n                        +- HashAggregate(keys=[Segment#29303, _groupingexpression#29314], functions=[partial_sum(Price#29313)], output=[Segment#29303, _groupingexpression#29314, sum#29320])\n                          +- Project [Segment#29303, Price#29313, substr(cast(Date#29306 as string), 1, 4) AS _groupingexpression#29314]\n                              +- SortMergeJoin [CustomerID#29302], [CustomerID#29308], Inner\n                                :- Sort [CustomerID#29302 ASC NULLS FIRST], false, 0\n                                :  +- Exchange hashpartitioning(CustomerID#29302, 200), ENSURE_REQUIREMENTS, [plan_id=48253]\n                                :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29302,Segment#29303] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>\n                                +- Sort [CustomerID#29308 ASC NULLS FIRST], false, 0\n                                    +- Exchange hashpartitioning(CustomerID#29308, 200), ENSURE_REQUIREMENTS, [plan_id=48254]\n                                      +- Filter (substr(cast(Date#29306 as string), 1, 4) IN (2012,2013) AND (substr(cast(Date#29306 as string), 1, 4) = 2012))\n                                          +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29306,CustomerID#29308,Price#29313] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- Sort [PercentageIncrease#29324 DESC NULLS LAST], true, 0\n  +- Exchange rangepartitioning(PercentageIncrease#29324 DESC NULLS LAST, 200), ENSURE_REQUIREMENTS, [plan_id=48385]\n  +- Project [Segment#29203, TotalConsumption#29326 AS Consumption2013#29321, TotalConsumption#29334 AS Consumption2012#29322, (TotalConsumption#29326 - TotalConsumption#29334) AS IncreaseDecrease#29323, (((TotalConsumption#29326 - TotalConsumption#29334) / TotalConsumption#29326) * 100.0) AS PercentageIncrease#29324]\n  +- SortMergeJoin [Segment#29203], [Segment#29351], Inner\n  :- Sort [Segment#29203 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(Segment#29203, 200), ENSURE_REQUIREMENTS, [plan_id=48378]\n  :     +- HashAggregate(keys=[Segment#29203, _groupingexpression#29349], functions=[sum(Price#29219)])\n  :        +- Exchange hashpartitioning(Segment#29203, _groupingexpression#29349, 200), ENSURE_REQUIREMENTS, [plan_id=48363]\n  :           +- HashAggregate(keys=[Segment#29203, _groupingexpression#29349], functions=[partial_sum(Price#29219)])\n  :              +- Project [Segment#29203, Price#29219, substr(cast(Date#29212 as string), 1, 4) AS _groupingexpression#29349]\n  :                 +- SortMergeJoin [CustomerID#29202], [CustomerID#29214], Inner\n  :                    :- Sort [CustomerID#29202 ASC NULLS FIRST], false, 0\n  :                    :  +- Exchange hashpartitioning(CustomerID#29202, 200), ENSURE_REQUIREMENTS, [plan_id=48355]\n  :                    :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>\n  :                    +- Sort [CustomerID#29214 ASC NULLS FIRST], false, 0\n  :                       +- Exchange hashpartitioning(CustomerID#29214, 200), ENSURE_REQUIREMENTS, [plan_id=48356]\n  :                          +- Filter (substr(cast(Date#29212 as string), 1, 4) IN (2012,2013) AND (substr(cast(Date#29212 as string), 1, 4) = 2013))\n  :                             +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29212,CustomerID#29214,Price#29219] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>\n  +- Sort [Segment#29351 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(Segment#29351, 200), ENSURE_REQUIREMENTS, [plan_id=48379]\n  +- HashAggregate(keys=[Segment#29351, _groupingexpression#29362], functions=[sum(Price#29361)])\n  +- Exchange hashpartitioning(Segment#29351, _groupingexpression#29362, 200), ENSURE_REQUIREMENTS, [plan_id=48374]\n  +- HashAggregate(keys=[Segment#29351, _groupingexpression#29362], functions=[partial_sum(Price#29361)])\n  +- Project [Segment#29351, Price#29361, substr(cast(Date#29354 as string), 1, 4) AS _groupingexpression#29362]\n  +- SortMergeJoin [CustomerID#29350], [CustomerID#29356], Inner\n  :- Sort [CustomerID#29350 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(CustomerID#29350, 200), ENSURE_REQUIREMENTS, [plan_id=48366]\n  :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29350,Segment#29351] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>\n  +- Sort [CustomerID#29356 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(CustomerID#29356, 200), ENSURE_REQUIREMENTS, [plan_id=48367]\n  +- Filter (substr(cast(Date#29354 as string), 1, 4) IN (2012,2013) AND (substr(cast(Date#29354 as string), 1, 4) = 2012))\n  +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29354,CustomerID#29356,Price#29361] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>\n================================================================================"
    },
    "result_file_path": "/home/lars/Privat/RWTH/Auslandssemester/#KURSE/Safe Distributed Systems/Exercises/Practical_Exercise/NL2SQL2SPARK/RAW_RESULTS/benchmark_results_20260101_google_ce2b3070/1482/20260101_125111_ID_1482_ITER_10_bb1f260c.json",
    "explainer_metrics": {
        "golden_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 2,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 1,
                "ShuffleExchange": 0,
                "TOTAL": 3
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Segment:string>",
                    "filters": [
                        "*IsNotNull(CustomerID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"CustomerID\", \"Date\", \"Consumption\" FROM \"yearmonth\") AS \"yearmonth\") [numPartitions=1] [CustomerID#29222,Date#29223,Consumption#29224] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Date:string,Consumption:double>",
                    "filters": [
                        "*IsNotNull(CustomerID)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Segment:string>",
                    "filters": [
                        "*IsNotNull(CustomerID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"CustomerID\", \"Date\", \"Consumption\" FROM \"yearmonth\") AS \"yearmonth\") [numPartitions=1] [CustomerID#29222,Date#29223,Consumption#29224] PushedFilters: [*IsNotNull(CustomerID)], ReadSchema: struct<CustomerID:int,Date:string,Consumption:double>",
                    "filters": [
                        "*IsNotNull(CustomerID)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 2
        },
        "model_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 8,
                "Exchange\\s+rangepartitioning\\(": 1,
                "Exchange\\s+SinglePartition": 0,
                "ShuffleExchange": 0,
                "TOTAL": 9
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":                    :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>",
                    "filters": [
                        "*IsNotNull(Currency)",
                        "*EqualTo(Currency",
                        "EUR)",
                        "*IsNotNull(CustomerID)",
                        "*IsNotNull(Segment)"
                    ]
                },
                {
                    "scan_line": ":                             +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29212,CustomerID#29214,Price#29219] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>",
                    "filters": [
                        "*IsNotNull(Date)",
                        "*IsNotNull(CustomerID)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29302,Segment#29303] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>",
                    "filters": [
                        "*IsNotNull(Currency)",
                        "*EqualTo(Currency",
                        "EUR)",
                        "*IsNotNull(CustomerID)",
                        "*IsNotNull(Segment)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29306,CustomerID#29308,Price#29313] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>",
                    "filters": [
                        "*IsNotNull(Date)",
                        "*IsNotNull(CustomerID)"
                    ]
                },
                {
                    "scan_line": ":                    :     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29202,Segment#29203] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>",
                    "filters": [
                        "*IsNotNull(Currency)",
                        "*EqualTo(Currency",
                        "EUR)",
                        "*IsNotNull(CustomerID)",
                        "*IsNotNull(Segment)"
                    ]
                },
                {
                    "scan_line": ":                             +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29212,CustomerID#29214,Price#29219] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>",
                    "filters": [
                        "*IsNotNull(Date)",
                        "*IsNotNull(CustomerID)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"CustomerID\", \"Segment\", \"Currency\" FROM \"customers\") AS \"customers\") [numPartitions=1] [CustomerID#29350,Segment#29351] PushedFilters: [*IsNotNull(Currency), *EqualTo(Currency,EUR), *IsNotNull(CustomerID), *IsNotNull(Segment)], ReadSchema: struct<CustomerID:int,Segment:string>",
                    "filters": [
                        "*IsNotNull(Currency)",
                        "*EqualTo(Currency",
                        "EUR)",
                        "*IsNotNull(CustomerID)",
                        "*IsNotNull(Segment)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [Date#29354,CustomerID#29356,Price#29361] PushedFilters: [*IsNotNull(Date), *IsNotNull(CustomerID)], ReadSchema: struct<Date:decimal(38,18),CustomerID:int,Price:double>",
                    "filters": [
                        "*IsNotNull(Date)",
                        "*IsNotNull(CustomerID)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 4
        },
        "plan_equivalence": {
            "golden_vs_model_physical_equivalent": false
        }
    }
}