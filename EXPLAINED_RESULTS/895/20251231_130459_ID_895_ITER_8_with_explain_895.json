{
    "query_id": 895,
    "difficulty": "moderate",
    "is_initial": true,
    "nl_query": "What is the average lap time for Lewis Hamilton in the 2009 Malaysian Grand Prix? average lap time = AVG(milliseconds); 'Lewis Hamilton' refers to the full name of the driver; Full name of the driver refers to drivers.forename and drivers.surname; 'Malaysian Grand Prix' refers to races.name = 'Malaysian Grand Prix'",
    "golden_query": "SELECT AVG(T2.milliseconds) FROM races AS T1 INNER JOIN lapTimes AS T2 ON T2.raceId = T1.raceId INNER JOIN drivers AS T3 ON T3.driverId = T2.driverId WHERE T3.forename = 'Lewis' AND T3.surname = 'Hamilton' AND T1.year = 2009 AND T1.name = 'Malaysian Grand Prix'",
    "sparksql_query": "SELECT AVG(lt.milliseconds) FROM laptimes AS lt JOIN drivers AS d ON lt.driverId = d.driverId JOIN races AS r ON lt.raceId = r.raceId WHERE d.forename = 'Lewis' AND d.surname = 'Hamilton' AND r.name = 'Malaysian Grand Prix' AND r.year = 2009",
    "jaccard_index": 1.0,
    "exact_match": 1,
    "ground_truth": [
        {
            "avg(milliseconds)": 109398.54838709677
        }
    ],
    "query_result": [
        [
            "109398.54838709677"
        ]
    ],
    "execution_plans": {
        "golden_query": "\nExecution Plan for: Golden Query ID 895...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'Project [unresolvedalias('AVG('T2.milliseconds))]\n+- 'Filter ((('T3.forename = Lewis) AND ('T3.surname = Hamilton)) AND (('T1.year = 2009) AND ('T1.name = Malaysian Grand Prix)))\n   +- 'Join Inner, ('T3.driverId = 'T2.driverId)\n      :- 'Join Inner, ('T2.raceId = 'T1.raceId)\n      :  :- 'SubqueryAlias T1\n      :  :  +- 'UnresolvedRelation [races], [], false\n      :  +- 'SubqueryAlias T2\n      :     +- 'UnresolvedRelation [lapTimes], [], false\n      +- 'SubqueryAlias T3\n         +- 'UnresolvedRelation [drivers], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nAggregate [avg(milliseconds#1601) AS avg(milliseconds)#1639]\n+- Project [milliseconds#1601]\n   +- Join Inner, (driverId#1558 = driverId#1597)\n      :- Project [driverId#1597, milliseconds#1601]\n      :  +- Join Inner, (raceId#1596 = raceId#1569)\n      :     :- Project [raceId#1569]\n      :     :  +- Filter (((isnotnull(year#1570) AND isnotnull(name#1573)) AND ((year#1570 = 2009) AND (name#1573 = Malaysian Grand Prix))) AND isnotnull(raceId#1569))\n      :     :     +- Relation [raceId#1569,year#1570,round#1571,circuitId#1572,name#1573,date#1574,time#1575,url#1576] JDBCRelation((SELECT \"raceId\", \"year\", \"round\", \"circuitId\", \"name\", CAST(\"date\" AS TEXT) AS \"date\", \"time\", \"url\" FROM \"races\") AS \"races\") [numPartitions=1]\n      :     +- Project [raceId#1596, driverId#1597, milliseconds#1601]\n      :        +- Filter (isnotnull(raceId#1596) AND isnotnull(driverId#1597))\n      :           +- Relation [raceId#1596,driverId#1597,lap#1598,position#1599,time#1600,milliseconds#1601] JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1]\n      +- Project [driverId#1558]\n         +- Filter (((isnotnull(forename#1562) AND isnotnull(surname#1563)) AND ((forename#1562 = Lewis) AND (surname#1563 = Hamilton))) AND isnotnull(driverId#1558))\n            +- Relation [driverId#1558,driverRef#1559,number#1560,code#1561,forename#1562,surname#1563,dob#1564,nationality#1565,url#1566] JDBCRelation((SELECT \"driverId\", \"driverRef\", \"number\", \"code\", \"forename\", \"surname\", CAST(\"dob\" AS TEXT) AS \"dob\", \"nationality\", \"url\" FROM \"drivers\") AS \"drivers\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- HashAggregate(keys=[], functions=[avg(milliseconds#1601)], output=[avg(milliseconds)#1639])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=5194]\n      +- HashAggregate(keys=[], functions=[partial_avg(milliseconds#1601)], output=[sum#1642, count#1643L])\n        +- Project [milliseconds#1601]\n            +- SortMergeJoin [driverId#1597], [driverId#1558], Inner\n              :- Sort [driverId#1597 ASC NULLS FIRST], false, 0\n              :  +- Exchange hashpartitioning(driverId#1597, 200), ENSURE_REQUIREMENTS, [plan_id=5186]\n              :     +- Project [driverId#1597, milliseconds#1601]\n              :        +- SortMergeJoin [raceId#1569], [raceId#1596], Inner\n              :           :- Sort [raceId#1569 ASC NULLS FIRST], false, 0\n              :           :  +- Exchange hashpartitioning(raceId#1569, 200), ENSURE_REQUIREMENTS, [plan_id=5178]\n              :           :     +- Scan JDBCRelation((SELECT \"raceId\", \"year\", \"round\", \"circuitId\", \"name\", CAST(\"date\" AS TEXT) AS \"date\", \"time\", \"url\" FROM \"races\") AS \"races\") [numPartitions=1] [raceId#1569] PushedFilters: [*EqualTo(name,Malaysian Grand Prix), *IsNotNull(year), *EqualTo(year,2009), *IsNotNull(name), *I..., ReadSchema: struct<raceId:int>\n              :           +- Sort [raceId#1596 ASC NULLS FIRST], false, 0\n              :              +- Exchange hashpartitioning(raceId#1596, 200), ENSURE_REQUIREMENTS, [plan_id=5179]\n              :                 +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(raceId), *IsNotNull(driverId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>\n              +- Sort [driverId#1558 ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(driverId#1558, 200), ENSURE_REQUIREMENTS, [plan_id=5187]\n                    +- Scan JDBCRelation((SELECT \"driverId\", \"driverRef\", \"number\", \"code\", \"forename\", \"surname\", CAST(\"dob\" AS TEXT) AS \"dob\", \"nationality\", \"url\" FROM \"drivers\") AS \"drivers\") [numPartitions=1] [driverId#1558] PushedFilters: [*IsNotNull(driverId), *IsNotNull(forename), *EqualTo(surname,Hamilton), *IsNotNull(surname), *Eq..., ReadSchema: struct<driverId:int>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- HashAggregate(keys=[], functions=[avg(milliseconds#1601)])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=5261]\n  +- HashAggregate(keys=[], functions=[partial_avg(milliseconds#1601)])\n  +- Project [milliseconds#1601]\n  +- SortMergeJoin [driverId#1597], [driverId#1558], Inner\n  :- Sort [driverId#1597 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(driverId#1597, 200), ENSURE_REQUIREMENTS, [plan_id=5253]\n  :     +- Project [driverId#1597, milliseconds#1601]\n  :        +- SortMergeJoin [raceId#1569], [raceId#1596], Inner\n  :           :- Sort [raceId#1569 ASC NULLS FIRST], false, 0\n  :           :  +- Exchange hashpartitioning(raceId#1569, 200), ENSURE_REQUIREMENTS, [plan_id=5245]\n  :           :     +- Scan JDBCRelation((SELECT \"raceId\", \"year\", \"round\", \"circuitId\", \"name\", CAST(\"date\" AS TEXT) AS \"date\", \"time\", \"url\" FROM \"races\") AS \"races\") [numPartitions=1] [raceId#1569] PushedFilters: [*EqualTo(name,Malaysian Grand Prix), *IsNotNull(year), *EqualTo(year,2009), *IsNotNull(name), *I..., ReadSchema: struct<raceId:int>\n  :           +- Sort [raceId#1596 ASC NULLS FIRST], false, 0\n  :              +- Exchange hashpartitioning(raceId#1596, 200), ENSURE_REQUIREMENTS, [plan_id=5246]\n  :                 +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(raceId), *IsNotNull(driverId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>\n  +- Sort [driverId#1558 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(driverId#1558, 200), ENSURE_REQUIREMENTS, [plan_id=5254]\n  +- Scan JDBCRelation((SELECT \"driverId\", \"driverRef\", \"number\", \"code\", \"forename\", \"surname\", CAST(\"dob\" AS TEXT) AS \"dob\", \"nationality\", \"url\" FROM \"drivers\") AS \"drivers\") [numPartitions=1] [driverId#1558] PushedFilters: [*IsNotNull(driverId), *IsNotNull(forename), *EqualTo(surname,Hamilton), *IsNotNull(surname), *Eq..., ReadSchema: struct<driverId:int>\n================================================================================",
        "model_query": "\nExecution Plan for: Model Query ID 895...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'Project [unresolvedalias('AVG('lt.milliseconds))]\n+- 'Filter ((('d.forename = Lewis) AND ('d.surname = Hamilton)) AND (('r.name = Malaysian Grand Prix) AND ('r.year = 2009)))\n   +- 'Join Inner, ('lt.raceId = 'r.raceId)\n      :- 'Join Inner, ('lt.driverId = 'd.driverId)\n      :  :- 'SubqueryAlias lt\n      :  :  +- 'UnresolvedRelation [laptimes], [], false\n      :  +- 'SubqueryAlias d\n      :     +- 'UnresolvedRelation [drivers], [], false\n      +- 'SubqueryAlias r\n         +- 'UnresolvedRelation [races], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nAggregate [avg(milliseconds#1601) AS avg(milliseconds)#1655]\n+- Project [milliseconds#1601]\n   +- Join Inner, (raceId#1596 = raceId#1569)\n      :- Project [raceId#1596, milliseconds#1601]\n      :  +- Join Inner, (driverId#1597 = driverId#1558)\n      :     :- Project [raceId#1596, driverId#1597, milliseconds#1601]\n      :     :  +- Filter (isnotnull(driverId#1597) AND isnotnull(raceId#1596))\n      :     :     +- Relation [raceId#1596,driverId#1597,lap#1598,position#1599,time#1600,milliseconds#1601] JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1]\n      :     +- Project [driverId#1558]\n      :        +- Filter (((isnotnull(forename#1562) AND isnotnull(surname#1563)) AND ((forename#1562 = Lewis) AND (surname#1563 = Hamilton))) AND isnotnull(driverId#1558))\n      :           +- Relation [driverId#1558,driverRef#1559,number#1560,code#1561,forename#1562,surname#1563,dob#1564,nationality#1565,url#1566] JDBCRelation((SELECT \"driverId\", \"driverRef\", \"number\", \"code\", \"forename\", \"surname\", CAST(\"dob\" AS TEXT) AS \"dob\", \"nationality\", \"url\" FROM \"drivers\") AS \"drivers\") [numPartitions=1]\n      +- Project [raceId#1569]\n         +- Filter (((isnotnull(name#1573) AND isnotnull(year#1570)) AND ((name#1573 = Malaysian Grand Prix) AND (year#1570 = 2009))) AND isnotnull(raceId#1569))\n            +- Relation [raceId#1569,year#1570,round#1571,circuitId#1572,name#1573,date#1574,time#1575,url#1576] JDBCRelation((SELECT \"raceId\", \"year\", \"round\", \"circuitId\", \"name\", CAST(\"date\" AS TEXT) AS \"date\", \"time\", \"url\" FROM \"races\") AS \"races\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- HashAggregate(keys=[], functions=[avg(milliseconds#1601)], output=[avg(milliseconds)#1655])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=5328]\n      +- HashAggregate(keys=[], functions=[partial_avg(milliseconds#1601)], output=[sum#1658, count#1659L])\n        +- Project [milliseconds#1601]\n            +- SortMergeJoin [raceId#1596], [raceId#1569], Inner\n              :- Sort [raceId#1596 ASC NULLS FIRST], false, 0\n              :  +- Exchange hashpartitioning(raceId#1596, 200), ENSURE_REQUIREMENTS, [plan_id=5320]\n              :     +- Project [raceId#1596, milliseconds#1601]\n              :        +- SortMergeJoin [driverId#1597], [driverId#1558], Inner\n              :           :- Sort [driverId#1597 ASC NULLS FIRST], false, 0\n              :           :  +- Exchange hashpartitioning(driverId#1597, 200), ENSURE_REQUIREMENTS, [plan_id=5312]\n              :           :     +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(driverId), *IsNotNull(raceId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>\n              :           +- Sort [driverId#1558 ASC NULLS FIRST], false, 0\n              :              +- Exchange hashpartitioning(driverId#1558, 200), ENSURE_REQUIREMENTS, [plan_id=5313]\n              :                 +- Scan JDBCRelation((SELECT \"driverId\", \"driverRef\", \"number\", \"code\", \"forename\", \"surname\", CAST(\"dob\" AS TEXT) AS \"dob\", \"nationality\", \"url\" FROM \"drivers\") AS \"drivers\") [numPartitions=1] [driverId#1558] PushedFilters: [*IsNotNull(driverId), *IsNotNull(forename), *EqualTo(surname,Hamilton), *IsNotNull(surname), *Eq..., ReadSchema: struct<driverId:int>\n              +- Sort [raceId#1569 ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(raceId#1569, 200), ENSURE_REQUIREMENTS, [plan_id=5321]\n                    +- Scan JDBCRelation((SELECT \"raceId\", \"year\", \"round\", \"circuitId\", \"name\", CAST(\"date\" AS TEXT) AS \"date\", \"time\", \"url\" FROM \"races\") AS \"races\") [numPartitions=1] [raceId#1569] PushedFilters: [*EqualTo(name,Malaysian Grand Prix), *IsNotNull(year), *EqualTo(year,2009), *IsNotNull(name), *I..., ReadSchema: struct<raceId:int>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- HashAggregate(keys=[], functions=[avg(milliseconds#1601)])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=5395]\n  +- HashAggregate(keys=[], functions=[partial_avg(milliseconds#1601)])\n  +- Project [milliseconds#1601]\n  +- SortMergeJoin [raceId#1596], [raceId#1569], Inner\n  :- Sort [raceId#1596 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(raceId#1596, 200), ENSURE_REQUIREMENTS, [plan_id=5387]\n  :     +- Project [raceId#1596, milliseconds#1601]\n  :        +- SortMergeJoin [driverId#1597], [driverId#1558], Inner\n  :           :- Sort [driverId#1597 ASC NULLS FIRST], false, 0\n  :           :  +- Exchange hashpartitioning(driverId#1597, 200), ENSURE_REQUIREMENTS, [plan_id=5379]\n  :           :     +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(driverId), *IsNotNull(raceId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>\n  :           +- Sort [driverId#1558 ASC NULLS FIRST], false, 0\n  :              +- Exchange hashpartitioning(driverId#1558, 200), ENSURE_REQUIREMENTS, [plan_id=5380]\n  :                 +- Scan JDBCRelation((SELECT \"driverId\", \"driverRef\", \"number\", \"code\", \"forename\", \"surname\", CAST(\"dob\" AS TEXT) AS \"dob\", \"nationality\", \"url\" FROM \"drivers\") AS \"drivers\") [numPartitions=1] [driverId#1558] PushedFilters: [*IsNotNull(driverId), *IsNotNull(forename), *EqualTo(surname,Hamilton), *IsNotNull(surname), *Eq..., ReadSchema: struct<driverId:int>\n  +- Sort [raceId#1569 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(raceId#1569, 200), ENSURE_REQUIREMENTS, [plan_id=5388]\n  +- Scan JDBCRelation((SELECT \"raceId\", \"year\", \"round\", \"circuitId\", \"name\", CAST(\"date\" AS TEXT) AS \"date\", \"time\", \"url\" FROM \"races\") AS \"races\") [numPartitions=1] [raceId#1569] PushedFilters: [*EqualTo(name,Malaysian Grand Prix), *IsNotNull(year), *EqualTo(year,2009), *IsNotNull(name), *I..., ReadSchema: struct<raceId:int>\n================================================================================"
    },
    "result_file_path": "/home/lars/Privat/RWTH/Auslandssemester/#KURSE/Safe Distributed Systems/Exercises/Practical_Exercise/NL2SQL2SPARK/RAW_RESULTS/benchmark_results_20251231_google_06264356/895/20251231_130459_ID_895_ITER_8_8f37b651.json",
    "explainer_metrics": {
        "golden_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 4,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 1,
                "ShuffleExchange": 0,
                "TOTAL": 5
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":                 +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(raceId), *IsNotNull(driverId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>",
                    "filters": [
                        "*IsNotNull(raceId)",
                        "*IsNotNull(driverId)"
                    ]
                },
                {
                    "scan_line": ":                 +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(raceId), *IsNotNull(driverId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>",
                    "filters": [
                        "*IsNotNull(raceId)",
                        "*IsNotNull(driverId)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 3
        },
        "model_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 4,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 1,
                "ShuffleExchange": 0,
                "TOTAL": 5
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":           :     +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(driverId), *IsNotNull(raceId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>",
                    "filters": [
                        "*IsNotNull(driverId)",
                        "*IsNotNull(raceId)"
                    ]
                },
                {
                    "scan_line": ":           :     +- Scan JDBCRelation((SELECT \"raceId\", \"driverId\", \"lap\", \"position\", \"time\", \"milliseconds\" FROM \"lapTimes\") AS \"lapTimes\") [numPartitions=1] [raceId#1596,driverId#1597,milliseconds#1601] PushedFilters: [*IsNotNull(driverId), *IsNotNull(raceId)], ReadSchema: struct<raceId:int,driverId:int,milliseconds:int>",
                    "filters": [
                        "*IsNotNull(driverId)",
                        "*IsNotNull(raceId)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 3
        },
        "plan_equivalence": {
            "golden_vs_model_physical_equivalent": false
        }
    }
}