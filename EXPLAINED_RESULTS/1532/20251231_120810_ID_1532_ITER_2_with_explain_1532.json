{
    "query_id": 1532,
    "difficulty": "simple",
    "is_initial": true,
    "nl_query": "Which country had the gas station that sold the most expensive product id No.2 for one unit? ",
    "golden_query": "SELECT T2.Country FROM transactions_1k AS T1 INNER JOIN gasstations AS T2 ON T1.GasStationID = T2.GasStationID WHERE T1.ProductID = 2 ORDER BY T1.Price DESC LIMIT 1",
    "sparksql_query": "SELECT T2.Country FROM transactions_1k AS T1 INNER JOIN gasstations AS T2 ON T1.GasStationID = T2.GasStationID WHERE T1.ProductID = 2 ORDER BY (T1.Price / T1.Amount) DESC LIMIT 1;",
    "jaccard_index": null,
    "exact_match": null,
    "ground_truth": null,
    "query_result": null,
    "execution_plans": {
        "golden_query": "\nExecution Plan for: Golden Query ID 1532...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'GlobalLimit 1\n+- 'LocalLimit 1\n   +- 'Sort ['T1.Price DESC NULLS LAST], true\n      +- 'Project ['T2.Country]\n         +- 'Filter ('T1.ProductID = 2)\n            +- 'Join Inner, ('T1.GasStationID = 'T2.GasStationID)\n               :- 'SubqueryAlias T1\n               :  +- 'UnresolvedRelation [transactions_1k], [], false\n               +- 'SubqueryAlias T2\n                  +- 'UnresolvedRelation [gasstations], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nGlobalLimit 1\n+- LocalLimit 1\n   +- Project [Country#9824]\n      +- Sort [Price#9836 DESC NULLS LAST], true\n         +- Project [Country#9824, Price#9836]\n            +- Join Inner, (GasStationID#9833 = GasStationID#9822)\n               :- Project [GasStationID#9833, Price#9836]\n               :  +- Filter ((isnotnull(ProductID#9834) AND (ProductID#9834 = 2)) AND isnotnull(GasStationID#9833))\n               :     +- Relation [TransactionID#9828,Date#9829,Time#9830,CustomerID#9831,CardID#9832,GasStationID#9833,ProductID#9834,Amount#9835,Price#9836] JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1]\n               +- Project [GasStationID#9822, Country#9824]\n                  +- Filter isnotnull(GasStationID#9822)\n                     +- Relation [GasStationID#9822,ChainID#9823,Country#9824,Segment#9825] JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- TakeOrderedAndProject(limit=1, orderBy=[Price#9836 DESC NULLS LAST], output=[Country#9824])\n  +- Project [Country#9824, Price#9836]\n      +- SortMergeJoin [GasStationID#9833], [GasStationID#9822], Inner\n        :- Sort [GasStationID#9833 ASC NULLS FIRST], false, 0\n        :  +- Exchange hashpartitioning(GasStationID#9833, 200), ENSURE_REQUIREMENTS, [plan_id=23177]\n        :     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Price:double>\n        +- Sort [GasStationID#9822 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(GasStationID#9822, 200), ENSURE_REQUIREMENTS, [plan_id=23178]\n              +- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- TakeOrderedAndProject(limit=1, orderBy=[Price#9836 DESC NULLS LAST], output=[Country#9824])\n  +- Project [Country#9824, Price#9836]\n  +- SortMergeJoin [GasStationID#9833], [GasStationID#9822], Inner\n  :- Sort [GasStationID#9833 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(GasStationID#9833, 200), ENSURE_REQUIREMENTS, [plan_id=23212]\n  :     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Price:double>\n  +- Sort [GasStationID#9822 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(GasStationID#9822, 200), ENSURE_REQUIREMENTS, [plan_id=23213]\n  +- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>\n================================================================================",
        "model_query": "\nExecution Plan for: Model Query ID 1532...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'GlobalLimit 1\n+- 'LocalLimit 1\n   +- 'Sort [('T1.Price / 'T1.Amount) DESC NULLS LAST], true\n      +- 'Project ['T2.Country]\n         +- 'Filter ('T1.ProductID = 2)\n            +- 'Join Inner, ('T1.GasStationID = 'T2.GasStationID)\n               :- 'SubqueryAlias T1\n               :  +- 'UnresolvedRelation [transactions_1k], [], false\n               +- 'SubqueryAlias T2\n                  +- 'UnresolvedRelation [gasstations], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nGlobalLimit 1\n+- LocalLimit 1\n   +- Project [Country#9824]\n      +- Sort [(Price#9836 / cast(Amount#9835 as double)) DESC NULLS LAST], true\n         +- Project [Country#9824, Price#9836, Amount#9835]\n            +- Join Inner, (GasStationID#9833 = GasStationID#9822)\n               :- Project [GasStationID#9833, Amount#9835, Price#9836]\n               :  +- Filter ((isnotnull(ProductID#9834) AND (ProductID#9834 = 2)) AND isnotnull(GasStationID#9833))\n               :     +- Relation [TransactionID#9828,Date#9829,Time#9830,CustomerID#9831,CardID#9832,GasStationID#9833,ProductID#9834,Amount#9835,Price#9836] JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1]\n               +- Project [GasStationID#9822, Country#9824]\n                  +- Filter isnotnull(GasStationID#9822)\n                     +- Relation [GasStationID#9822,ChainID#9823,Country#9824,Segment#9825] JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- TakeOrderedAndProject(limit=1, orderBy=[(Price#9836 / cast(Amount#9835 as double)) DESC NULLS LAST], output=[Country#9824])\n  +- Project [Country#9824, Price#9836, Amount#9835]\n      +- SortMergeJoin [GasStationID#9833], [GasStationID#9822], Inner\n        :- Sort [GasStationID#9833 ASC NULLS FIRST], false, 0\n        :  +- Exchange hashpartitioning(GasStationID#9833, 200), ENSURE_REQUIREMENTS, [plan_id=23247]\n        :     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Amount#9835,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Amount:int,Price:double>\n        +- Sort [GasStationID#9822 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(GasStationID#9822, 200), ENSURE_REQUIREMENTS, [plan_id=23248]\n              +- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- TakeOrderedAndProject(limit=1, orderBy=[(Price#9836 / cast(Amount#9835 as double)) DESC NULLS LAST], output=[Country#9824])\n  +- Project [Country#9824, Price#9836, Amount#9835]\n  +- SortMergeJoin [GasStationID#9833], [GasStationID#9822], Inner\n  :- Sort [GasStationID#9833 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(GasStationID#9833, 200), ENSURE_REQUIREMENTS, [plan_id=23282]\n  :     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Amount#9835,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Amount:int,Price:double>\n  +- Sort [GasStationID#9822 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(GasStationID#9822, 200), ENSURE_REQUIREMENTS, [plan_id=23283]\n  +- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>\n================================================================================"
    },
    "result_file_path": "/home/lars/Privat/RWTH/Auslandssemester/#KURSE/Safe Distributed Systems/Exercises/Practical_Exercise/NL2SQL2SPARK/RAW_RESULTS/benchmark_results_20251231_google_d598f842/1532/20251231_120810_ID_1532_ITER_2_7c01002c.json",
    "explainer_metrics": {
        "golden_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 2,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 0,
                "ShuffleExchange": 0,
                "TOTAL": 2
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Price:double>",
                    "filters": [
                        "*IsNotNull(ProductID)",
                        "*EqualTo(ProductID",
                        "2)",
                        "*IsNotNull(GasStationID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>",
                    "filters": [
                        "*IsNotNull(GasStationID)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Price:double>",
                    "filters": [
                        "*IsNotNull(ProductID)",
                        "*EqualTo(ProductID",
                        "2)",
                        "*IsNotNull(GasStationID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>",
                    "filters": [
                        "*IsNotNull(GasStationID)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 2
        },
        "model_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 2,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 0,
                "ShuffleExchange": 0,
                "TOTAL": 2
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Amount#9835,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Amount:int,Price:double>",
                    "filters": [
                        "*IsNotNull(ProductID)",
                        "*EqualTo(ProductID",
                        "2)",
                        "*IsNotNull(GasStationID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>",
                    "filters": [
                        "*IsNotNull(GasStationID)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"TransactionID\", CAST(\"Date\" AS TEXT) AS \"Date\", \"Time\", \"CustomerID\", \"CardID\", \"GasStationID\", \"ProductID\", \"Amount\", \"Price\" FROM \"transactions_1k\") AS \"transactions_1k\") [numPartitions=1] [GasStationID#9833,Amount#9835,Price#9836] PushedFilters: [*IsNotNull(ProductID), *EqualTo(ProductID,2), *IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Amount:int,Price:double>",
                    "filters": [
                        "*IsNotNull(ProductID)",
                        "*EqualTo(ProductID",
                        "2)",
                        "*IsNotNull(GasStationID)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"GasStationID\", \"ChainID\", \"Country\", \"Segment\" FROM \"gasstations\") AS \"gasstations\") [numPartitions=1] [GasStationID#9822,Country#9824] PushedFilters: [*IsNotNull(GasStationID)], ReadSchema: struct<GasStationID:int,Country:string>",
                    "filters": [
                        "*IsNotNull(GasStationID)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 2
        },
        "plan_equivalence": {
            "golden_vs_model_physical_equivalent": false
        }
    }
}