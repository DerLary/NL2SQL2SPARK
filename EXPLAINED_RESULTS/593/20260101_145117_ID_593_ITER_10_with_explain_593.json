{
    "query_id": 593,
    "difficulty": "simple",
    "is_initial": true,
    "nl_query": "How many users from New York have a teacher and supporter badge? \"Supporter\" and \"Teachers\" are both Name of badge; 'New York' is the Location; user refers to UserId",
    "golden_query": "SELECT COUNT(DISTINCT T1.Id) FROM badges AS T1 INNER JOIN users AS T2 ON T1.UserId = T2.Id WHERE T1.Name IN ('Supporter', 'Teacher') AND T2.Location = 'New York'",
    "sparksql_query": "SELECT COUNT(DISTINCT T1.Id) FROM users AS T1 INNER JOIN badges AS T2 ON T1.Id = T2.UserId WHERE T1.Location = 'New York' AND T2.Name IN ('Supporter', 'Teachers') GROUP BY T1.Id HAVING COUNT(DISTINCT T2.Name) = 2",
    "jaccard_index": 0.0,
    "exact_match": 0,
    "ground_truth": [
        {
            "count(DISTINCT Id)": 9
        }
    ],
    "query_result": [],
    "execution_plans": {
        "golden_query": "\nExecution Plan for: Golden Query ID 593...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'Project [unresolvedalias('COUNT(distinct 'T1.Id))]\n+- 'Filter ('T1.Name IN (Supporter,Teacher) AND ('T2.Location = New York))\n   +- 'Join Inner, ('T1.UserId = 'T2.Id)\n      :- 'SubqueryAlias T1\n      :  +- 'UnresolvedRelation [badges], [], false\n      +- 'SubqueryAlias T2\n         +- 'UnresolvedRelation [users], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nAggregate [count(distinct Id#37307) AS count(DISTINCT Id)#37379L]\n+- Project [Id#37307]\n   +- Join Inner, (UserId#37308 = Id#37358)\n      :- Project [Id#37307, UserId#37308]\n      :  +- Filter (Name#37309 IN (Supporter,Teacher) AND isnotnull(UserId#37308))\n      :     +- Relation [Id#37307,UserId#37308,Name#37309,Date#37310] JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1]\n      +- Project [Id#37358]\n         +- Filter ((isnotnull(Location#37364) AND (Location#37364 = New York)) AND isnotnull(Id#37358))\n            +- Relation [Id#37358,Reputation#37359,CreationDate#37360,DisplayName#37361,LastAccessDate#37362,WebsiteUrl#37363,Location#37364,AboutMe#37365,Views#37366,UpVotes#37367,DownVotes#37368,AccountId#37369,Age#37370,ProfileImageUrl#37371] JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- HashAggregate(keys=[], functions=[count(distinct Id#37307)], output=[count(DISTINCT Id)#37379L])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=62198]\n      +- HashAggregate(keys=[], functions=[partial_count(distinct Id#37307)], output=[count#37382L])\n        +- HashAggregate(keys=[Id#37307], functions=[], output=[Id#37307])\n            +- Exchange hashpartitioning(Id#37307, 200), ENSURE_REQUIREMENTS, [plan_id=62194]\n              +- HashAggregate(keys=[Id#37307], functions=[], output=[Id#37307])\n                  +- Project [Id#37307]\n                    +- SortMergeJoin [UserId#37308], [Id#37358], Inner\n                        :- Sort [UserId#37308 ASC NULLS FIRST], false, 0\n                        :  +- Exchange hashpartitioning(UserId#37308, 200), ENSURE_REQUIREMENTS, [plan_id=62186]\n                        :     +- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [Id#37307,UserId#37308] PushedFilters: [*In(Name, [Supporter,Teacher]), *IsNotNull(UserId)], ReadSchema: struct<Id:int,UserId:int>\n                        +- Sort [Id#37358 ASC NULLS FIRST], false, 0\n                          +- Exchange hashpartitioning(Id#37358, 200), ENSURE_REQUIREMENTS, [plan_id=62187]\n                              +- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- HashAggregate(keys=[], functions=[count(distinct Id#37307)])\n  +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=62255]\n  +- HashAggregate(keys=[], functions=[partial_count(distinct Id#37307)])\n  +- HashAggregate(keys=[Id#37307], functions=[])\n  +- Exchange hashpartitioning(Id#37307, 200), ENSURE_REQUIREMENTS, [plan_id=62251]\n  +- HashAggregate(keys=[Id#37307], functions=[])\n  +- Project [Id#37307]\n  +- SortMergeJoin [UserId#37308], [Id#37358], Inner\n  :- Sort [UserId#37308 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(UserId#37308, 200), ENSURE_REQUIREMENTS, [plan_id=62243]\n  :     +- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [Id#37307,UserId#37308] PushedFilters: [*In(Name, [Supporter,Teacher]), *IsNotNull(UserId)], ReadSchema: struct<Id:int,UserId:int>\n  +- Sort [Id#37358 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(Id#37358, 200), ENSURE_REQUIREMENTS, [plan_id=62244]\n  +- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>\n================================================================================",
        "model_query": "\nExecution Plan for: Model Query ID 593...\n================================================================================\n\n1. Logical plan:\n----------------------------------------\n'UnresolvedHaving ('COUNT(distinct 'T2.Name) = 2)\n+- 'Aggregate ['T1.Id], [unresolvedalias('COUNT(distinct 'T1.Id))]\n   +- 'Filter (('T1.Location = New York) AND 'T2.Name IN (Supporter,Teachers))\n      +- 'Join Inner, ('T1.Id = 'T2.UserId)\n         :- 'SubqueryAlias T1\n         :  +- 'UnresolvedRelation [users], [], false\n         +- 'SubqueryAlias T2\n            +- 'UnresolvedRelation [badges], [], false\n\n\n2. Optimized logical plan (After Catalyst AFAIK):\n----------------------------------------\nProject [count(DISTINCT Id)#37395L]\n+- Filter (count(distinct Name#37309)#37397L = 2)\n   +- Aggregate [Id#37358], [count(T1.Id#37399) FILTER (WHERE (gid#37398 = 1)) AS count(DISTINCT Id)#37395L, count(T2.Name#37400) FILTER (WHERE (gid#37398 = 2)) AS count(distinct Name#37309)#37397L]\n      +- Aggregate [Id#37358, T1.Id#37399, T2.Name#37400, gid#37398], [Id#37358, T1.Id#37399, T2.Name#37400, gid#37398]\n         +- Expand [[Id#37358, Id#37358, null, 1], [Id#37358, null, Name#37309, 2]], [Id#37358, T1.Id#37399, T2.Name#37400, gid#37398]\n            +- Project [Id#37358, Name#37309]\n               +- Join Inner, (Id#37358 = UserId#37308)\n                  :- Project [Id#37358]\n                  :  +- Filter ((isnotnull(Location#37364) AND (Location#37364 = New York)) AND isnotnull(Id#37358))\n                  :     +- Relation [Id#37358,Reputation#37359,CreationDate#37360,DisplayName#37361,LastAccessDate#37362,WebsiteUrl#37363,Location#37364,AboutMe#37365,Views#37366,UpVotes#37367,DownVotes#37368,AccountId#37369,Age#37370,ProfileImageUrl#37371] JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1]\n                  +- Project [UserId#37308, Name#37309]\n                     +- Filter (Name#37309 IN (Supporter,Teachers) AND isnotnull(UserId#37308))\n                        +- Relation [Id#37307,UserId#37308,Name#37309,Date#37310] JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1]\n\n\n3. Physical plan:\n----------------------------------------\nAdaptiveSparkPlan isFinalPlan=false\n+- Project [count(DISTINCT Id)#37395L]\n  +- Filter (count(distinct Name#37309)#37397L = 2)\n      +- HashAggregate(keys=[Id#37358], functions=[count(T1.Id#37399), count(T2.Name#37400)], output=[count(DISTINCT Id)#37395L, count(distinct Name#37309)#37397L])\n        +- Exchange hashpartitioning(Id#37358, 200), ENSURE_REQUIREMENTS, [plan_id=62327]\n            +- HashAggregate(keys=[Id#37358], functions=[partial_count(T1.Id#37399) FILTER (WHERE (gid#37398 = 1)), partial_count(T2.Name#37400) FILTER (WHERE (gid#37398 = 2))], output=[Id#37358, count#37403L, count#37404L])\n              +- HashAggregate(keys=[Id#37358, T1.Id#37399, T2.Name#37400, gid#37398], functions=[], output=[Id#37358, T1.Id#37399, T2.Name#37400, gid#37398])\n                  +- Exchange hashpartitioning(Id#37358, T1.Id#37399, T2.Name#37400, gid#37398, 200), ENSURE_REQUIREMENTS, [plan_id=62323]\n                    +- HashAggregate(keys=[Id#37358, T1.Id#37399, T2.Name#37400, gid#37398], functions=[], output=[Id#37358, T1.Id#37399, T2.Name#37400, gid#37398])\n                        +- Expand [[Id#37358, Id#37358, null, 1], [Id#37358, null, Name#37309, 2]], [Id#37358, T1.Id#37399, T2.Name#37400, gid#37398]\n                          +- Project [Id#37358, Name#37309]\n                              +- SortMergeJoin [Id#37358], [UserId#37308], Inner\n                                :- Sort [Id#37358 ASC NULLS FIRST], false, 0\n                                :  +- Exchange hashpartitioning(Id#37358, 200), ENSURE_REQUIREMENTS, [plan_id=62314]\n                                :     +- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>\n                                +- Sort [UserId#37308 ASC NULLS FIRST], false, 0\n                                    +- Exchange hashpartitioning(UserId#37308, 200), ENSURE_REQUIREMENTS, [plan_id=62315]\n                                      +- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [UserId#37308,Name#37309] PushedFilters: [*In(Name, [Supporter,Teachers]), *IsNotNull(UserId)], ReadSchema: struct<UserId:int,Name:string>\n\n4. Explain output:\n----------------------------------------\n\nPhysical Plan ==:\n-----------------\n  AdaptiveSparkPlan isFinalPlan=false\n  +- Project [count(DISTINCT Id)#37410L]\n  +- Filter (count(distinct Name#37309)#37412L = 2)\n  +- HashAggregate(keys=[Id#37358], functions=[count(T1.Id#37414), count(T2.Name#37415)])\n  +- Exchange hashpartitioning(Id#37358, 200), ENSURE_REQUIREMENTS, [plan_id=62401]\n  +- HashAggregate(keys=[Id#37358], functions=[partial_count(T1.Id#37414) FILTER (WHERE (gid#37413 = 1)), partial_count(T2.Name#37415) FILTER (WHERE (gid#37413 = 2))])\n  +- HashAggregate(keys=[Id#37358, T1.Id#37414, T2.Name#37415, gid#37413], functions=[])\n  +- Exchange hashpartitioning(Id#37358, T1.Id#37414, T2.Name#37415, gid#37413, 200), ENSURE_REQUIREMENTS, [plan_id=62397]\n  +- HashAggregate(keys=[Id#37358, T1.Id#37414, T2.Name#37415, gid#37413], functions=[])\n  +- Expand [[Id#37358, Id#37358, null, 1], [Id#37358, null, Name#37309, 2]], [Id#37358, T1.Id#37414, T2.Name#37415, gid#37413]\n  +- Project [Id#37358, Name#37309]\n  +- SortMergeJoin [Id#37358], [UserId#37308], Inner\n  :- Sort [Id#37358 ASC NULLS FIRST], false, 0\n  :  +- Exchange hashpartitioning(Id#37358, 200), ENSURE_REQUIREMENTS, [plan_id=62388]\n  :     +- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>\n  +- Sort [UserId#37308 ASC NULLS FIRST], false, 0\n  +- Exchange hashpartitioning(UserId#37308, 200), ENSURE_REQUIREMENTS, [plan_id=62389]\n  +- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [UserId#37308,Name#37309] PushedFilters: [*In(Name, [Supporter,Teachers]), *IsNotNull(UserId)], ReadSchema: struct<UserId:int,Name:string>\n================================================================================"
    },
    "result_file_path": "/home/lars/Privat/RWTH/Auslandssemester/#KURSE/Safe Distributed Systems/Exercises/Practical_Exercise/NL2SQL2SPARK/RAW_RESULTS/benchmark_results_20260101_google_34d5d5fd/593/20260101_145117_ID_593_ITER_10_294e3809.json",
    "explainer_metrics": {
        "golden_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 3,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 1,
                "ShuffleExchange": 0,
                "TOTAL": 4
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [Id#37307,UserId#37308] PushedFilters: [*In(Name, [Supporter,Teacher]), *IsNotNull(UserId)], ReadSchema: struct<Id:int,UserId:int>",
                    "filters": [
                        "*In(Name",
                        "[Supporter",
                        "Teacher"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>",
                    "filters": [
                        "*IsNotNull(Location)",
                        "*EqualTo(Location",
                        "New York)",
                        "*IsNotNull(Id)"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [Id#37307,UserId#37308] PushedFilters: [*In(Name, [Supporter,Teacher]), *IsNotNull(UserId)], ReadSchema: struct<Id:int,UserId:int>",
                    "filters": [
                        "*In(Name",
                        "[Supporter",
                        "Teacher"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>",
                    "filters": [
                        "*IsNotNull(Location)",
                        "*EqualTo(Location",
                        "New York)",
                        "*IsNotNull(Id)"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 2
        },
        "model_query": {
            "shuffle_count": {
                "Exchange\\s+hashpartitioning\\(": 4,
                "Exchange\\s+rangepartitioning\\(": 0,
                "Exchange\\s+SinglePartition": 0,
                "ShuffleExchange": 0,
                "TOTAL": 4
            },
            "has_broadcast_join": false,
            "has_predicate_pushdown": true,
            "pushed_filters": [
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>",
                    "filters": [
                        "*IsNotNull(Location)",
                        "*EqualTo(Location",
                        "New York)",
                        "*IsNotNull(Id)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [UserId#37308,Name#37309] PushedFilters: [*In(Name, [Supporter,Teachers]), *IsNotNull(UserId)], ReadSchema: struct<UserId:int,Name:string>",
                    "filters": [
                        "*In(Name",
                        "[Supporter",
                        "Teachers"
                    ]
                },
                {
                    "scan_line": ":     +- Scan JDBCRelation((SELECT \"Id\", \"Reputation\", CAST(\"CreationDate\" AS TEXT) AS \"CreationDate\", \"DisplayName\", CAST(\"LastAccessDate\" AS TEXT) AS \"LastAccessDate\", \"WebsiteUrl\", \"Location\", \"AboutMe\", \"Views\", \"UpVotes\", \"DownVotes\", \"AccountId\", \"Age\", \"ProfileImageUrl\" FROM \"users\") AS \"users\") [numPartitions=1] [Id#37358] PushedFilters: [*IsNotNull(Location), *EqualTo(Location,New York), *IsNotNull(Id)], ReadSchema: struct<Id:int>",
                    "filters": [
                        "*IsNotNull(Location)",
                        "*EqualTo(Location",
                        "New York)",
                        "*IsNotNull(Id)"
                    ]
                },
                {
                    "scan_line": "+- Scan JDBCRelation((SELECT \"Id\", \"UserId\", \"Name\", CAST(\"Date\" AS TEXT) AS \"Date\" FROM \"badges\") AS \"badges\") [numPartitions=1] [UserId#37308,Name#37309] PushedFilters: [*In(Name, [Supporter,Teachers]), *IsNotNull(UserId)], ReadSchema: struct<UserId:int,Name:string>",
                    "filters": [
                        "*In(Name",
                        "[Supporter",
                        "Teachers"
                    ]
                }
            ],
            "filter_count_before_optimization": 0,
            "filter_count_after_optimization": 3
        },
        "plan_equivalence": {
            "golden_vs_model_physical_equivalent": false
        }
    }
}